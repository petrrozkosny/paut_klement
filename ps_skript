# Nastavení, aby skript nevyžadoval manuální potvrzení
$excel = New-Object -ComObject Excel.Application
$excel.DisplayAlerts = $false

# Otevření souboru Excel (nahraďte cestu vaším souborem)
$workbook = $excel.Workbooks.Open(%NewVar%)

# Aktualizace dotazů Power Query
foreach ($query in $workbook.Queries)
{
    try
    {
        $workbook.Connections.Item($query.Name).Refresh()
    }
    catch
    {
        Write-Warning "Nelze aktualizovat dotaz: $($query.Name)"
    }
}

# Uložení, zavření a ukončení Excel
$workbook.Save()
$workbook.Close($true)
$excel.Quit()

# Uvolnění COM objektů
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($workbook) | Out-Null
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($excel) | Out-Null
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
